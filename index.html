<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <style>
    body {
      font-family: "Hiragino Kaku Gothic Pro", "Hiragino Sans", "Meiryo", sans-serif;
      max-width: 900px;
      margin: 20px auto;
    }
    h1 {
      color: #333;
    }
    table {
      width: 100%;
      max-width: 900px;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 4px;
      text-align: left;
      height: 24px;
    }
    th {
      background-color: #f2f2f2;
      color: #333;
      cursor: pointer;
      position: relative;
    }
    th.sort-asc::after, th.sort-desc::after {
      content: "";
      position: absolute;
      right: 10px;
      border: 5px solid transparent;
    }
    th.sort-asc::after {
      border-bottom-color: #333;
      top: 50%;
      transform: translateY(-50%);
    }
    th.sort-desc::after {
      border-top-color: #333;
      bottom: 50%;
      transform: translateY(50%);
    }
    tr:nth-child(even) {
      background-color: #f9f9f9;
    }
    tr:hover {
      background-color: #f1f1f1;
    }
    .copy-button {
      background-color: #4CAF50;
      color: white;
      border: none;
      padding: 10px 20px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 14px;
      margin: 4px 2px;
      cursor: pointer;
      border-radius: 4px;
      transition: background-color 0.3s;
    }
    .copy-button:hover {
      background-color: #45a049;
    }
    .filters-bar {
      display: flex;
      flex-wrap: wrap;
      justify-content: flex-start;
      align-items: center;
      padding: 10px 0;
      max-width: 900px;
    }
    .filters-bar .nav {
      display: flex;
      flex-wrap: wrap;
      list-style-type: none;
      justify-content: center;
      padding: 0;
    }
    .filters-bar .nav li {
      margin: 0 6px 6px 0;
    }
    .filters-bar .nav a {
      padding: 5px 10px;
      background-color: #ddd;
      border-radius: 16px;
      text-decoration: none;
      color: #333;
      cursor: pointer;
      white-space: nowrap;
      display: inline-block;
    }
    .filters-bar .nav a.selected {
      background-color: #ccc;
    }
    .filters-bar .nav a.reset-filter {
      background-color: #ffcccb;
    }
    .filters-bar .nav a.reset-filter:hover {
      background-color: #ffb3b0;
    }
    .filters-bar .nav a.zundamon {
      background-color: #e0f7e9;
    }
    .filters-bar .nav a.zundamon.selected {
      background-color: #c1e7d4;
    }
    .filters-bar .search-box {
      display: flex;
      align-items: center;
      margin-left: auto;
    }
    .filters-bar .search-box input {
      padding: 5px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
  </style>
  <script>
    let tableData = [
      // 静的データをここに入力します
      ["A列", "B列", "C列", "D列", "E列", "F列"],
      ["データ1", "データ2", "データ3", "ずんだもん", "データ5", "コピー1"],
      ["データ6", "データ7", "データ8", "他", "データ10", "コピー2"],
      // 必要に応じてさらにデータを追加
    ];
    let currentSortColumn = -1;
    let currentSortOrder = '';
    let selectedFilter = '';

    function loadSheetData() {
      renderFilters();
      renderTable(tableData);
    }

    function renderFilters() {
      const filtersBar = document.createElement('div');
      filtersBar.className = 'filters-bar';

      const nav = document.createElement('ul');
      nav.className = 'nav nav-center nav-bold nav-uppercase nav-pills';
      
      const dColumnIndex = 3;
      const uniqueDValues = [...new Set(tableData.slice(1).map(row => row[dColumnIndex]))];
      uniqueDValues.forEach(value => {
        const li = document.createElement('li');
        const a = document.createElement('a');
        a.innerText = value;
        a.className = value === 'ずんだもん' ? 'zundamon' : '';
        a.onclick = () => filterByDColumn(value, a);
        li.appendChild(a);
        nav.appendChild(li);
      });

      // フィルタをリセットするボタンを追加
      const li = document.createElement('li');
      const resetA = document.createElement('a');
      resetA.innerText = '全て表示';
      resetA.className = 'reset-filter';
      resetA.onclick = () => {
        selectedFilter = '';
        renderTable(tableData);
        updateSelectedFilter();
      };
      li.appendChild(resetA);
      nav.appendChild(li);

      const searchBox = document.createElement('div');
      searchBox.className = 'search-box';
      const input = document.createElement('input');
      input.type = 'text';
      input.placeholder = 'Search...';
      input.onkeyup = () => searchTable(input.value);
      searchBox.appendChild(input);

      filtersBar.appendChild(nav);
      filtersBar.appendChild(searchBox);
      document.body.insertBefore(filtersBar, document.getElementById('table-container'));
    }

    function filterByDColumn(value, element) {
      selectedFilter = value;
      const filteredData = tableData.filter((row, index) => index === 0 || row[3] === value);
      renderTable(filteredData);
      updateSelectedFilter(element);
    }

    function updateSelectedFilter(selectedElement) {
      const filterLinks = document.querySelectorAll('.filters-bar .nav a');
      filterLinks.forEach(link => {
        link.classList.remove('selected');
      });
      if (selectedElement) {
        selectedElement.classList.add('selected');
      }
    }

    function searchTable(query) {
      const lowerCaseQuery = query.toLowerCase();
      const filteredData = tableData.filter((row, index) => {
        if (index === 0) return true;
        return row.some(cell => cell.toString().toLowerCase().includes(lowerCaseQuery));
      });
      renderTable(filteredData);
    }

    function renderTable(data) {
      const table = document.createElement('table');
      const thead = document.createElement('thead');
      const tbody = document.createElement('tbody');

      // データの最初の行を使用してテーブルヘッダーを作成
      const headerRow = document.createElement('tr');
      data[0].forEach((header, index) => {
        if ([0, 3, 4].includes(index)) { // A列、D列、E列のみ含める
          const th = document.createElement('th');
          th.innerText = header;
          th.onclick = () => sortTable(index);
          if (currentSortColumn === index) {
            th.className = currentSortOrder === 'asc' ? 'sort-asc' : 'sort-desc';
          }
          headerRow.appendChild(th);
        }
      });
      const th = document.createElement('th');
      th.innerText = 'コマンドコピー';
      headerRow.appendChild(th);
      thead.appendChild(headerRow);

      // テーブルの本体を作成
      data.slice(1).forEach(row => {
        const tr = document.createElement('tr');

        [0, 3, 4].forEach(index => { // A列、D列、E列のみ含める
          const td = document.createElement('td');
          td.innerText = row[index];
          if (index === 0) {
            td.style.minWidth = `${row[index].length * 8}px`; // 幅を調整
            td.style.textAlign = 'center'; // A列を中央揃え
          }
          tr.appendChild(td);
        });

        const copyButtonTd = document.createElement('td');
        copyButtonTd.style.width = '160px';
        const copyButton = document.createElement('button');
        copyButton.innerText = 'Copy to Clipboard';
        copyButton.className = 'copy-button';
        copyButton.onclick = () => copyToClipboard(row[5]); // F列のデータをコピー
        copyButtonTd.appendChild(copyButton);
        tr.appendChild(copyButtonTd);

        tbody.appendChild(tr);
      });

      table.appendChild(thead);
      table.appendChild(tbody);
      document.getElementById('table-container').innerHTML = ''; // 前の内容をクリア
      document.getElementById('table-container').appendChild(table);
    }

    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        alert('設定コマンドをクリップボードにコピーしたよ！\nDiscordのチャットに貼り付けて実行してね！');
      }).catch(err => {
        console.error('コマンドのコピーに失敗したみたい・・・', err);
      });
    }

    function sortTable(columnIndex) {
      let sortedData;
      if (currentSortColumn === columnIndex) {
        currentSortOrder = currentSortOrder === 'asc' ? 'desc' : 'asc';
      } else {
        currentSortColumn = columnIndex;
        currentSortOrder = 'asc';
      }
      if (currentSortOrder === 'asc') {
        sortedData = [...tableData.slice(1)].sort((a, b) => a[columnIndex].localeCompare(b[columnIndex]));
      } else {
        sortedData = [...tableData.slice(1)].sort((a, b) => b[columnIndex].localeCompare(a[columnIndex]));
      }
      renderTable([tableData[0], ...sortedData]);
    }

    window.onload = loadSheetData;
  </script>
</head>
<body>
  <h1>わるいまりも - 読み上げ話者コマンド一覧</h1>
  <p>設定したいキャラクターの「Copy to Clipboard」をクリックして、Discordに貼り付けてね</p>
  <div id="table-container"></div>
</body>
</html>
